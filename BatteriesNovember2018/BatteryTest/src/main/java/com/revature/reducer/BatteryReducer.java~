package com.revature.reducer;

import java.io.IOException;

import org.apache.hadoop.io.Text;
import org.apache.hadoop.mapreduce.Reducer;

public class BatteryReducer extends Reducer<Text, Text, Text, Text> {

	@Override
	public void reduce(Text key, Iterable<Text> values, Context context) throws IOException, InterruptedException {

		String[] temp = new String[10];
		StringBuilder line = new StringBuilder("");
		String[] scores = new String[10];
		int testTypeIndex = 0;
		String keyString = key.toString();
		String testTypePPP = "isPPP";
		String delimiter = "\t";


		for (Text value : values) {
			temp = value.toString().split(delimiter);
			try{
				int week = Integer.parseInt(temp[0]);
				String score = temp[1];

				scores[week-1] = score;
				
			}catch(Exception ex){
				return;
			}
		}
		
		if(keyString.contains(testTypePPP)){
			int currentScoreIndex = 0;
			String[] tempScores = new String[10];
			for(String score: scores){
				if(score != null){
					tempScores[currentScoreIndex] = score;
					currentScoreIndex++;
				}
			}
			scores = tempScores;
		}



		for(String score : scores){
			if (score == null){
				line.append(delimiter+"-1");
			}else{
				line.append(delimiter + score);
			}  
		}
		String output = line.substring(1);
		context.write(key, new Text(output));
	}
}
