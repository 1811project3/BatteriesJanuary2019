<!--
This file is intended to be the final ETL Workflow for the main Oozie Bundle.

WARNING: Currently under development

-->

<workflow-app xmlns = "uri:oozie:workflow:0.4" name = "ETL_Workflow">

    <!--Start Workflow -->
    <start to = "Import_Fork"/>
    
    <!--Start Caliber Imports -->
    <fork name = "Import_Fork">
        <path start = "Import_Address"/>
        <path start = "Import_Assessment"/>
        <path start = "Import_Batch"/>
        <path start = "Import_Grade"/>
        <path start = "Import_Note"/>
        <path start = "Import_Trainee"/>
        <path start = "Import_Trainer"/>
    </fork>

    <action name="Import_Address">
		<sqoop xmlns="uri:oozie:sqoop-action:0.4">
			<job-tracker>quickstart.cloudera:8032</job-tracker>
			<name-node>quickstart.cloudera:8020</name-node>
			<command>
            import -Dhadoop.security.credential.provider.path=jceks://hdfs/user/root/mysql.password.jceks --connect jdbc:oracle:thin:@caliber-snap.cgbbs6xdwjwh.us-west-2.rds.amazonaws.com:1521/orcl --username caliber --password-alias mydb.password.alias --table CALIBER_ADDRESS --columns ADDRESS_ID,ADDRESS_CITY --mysql-delimiters --target-dir project3/new/address --delete-target-dir -m 1
            </command>
		</sqoop>
        <ok to = "end" />
        <error to = "kill" />
	</action>

    <action name="Import_Assessment">
		<sqoop xmlns="uri:oozie:sqoop-action:0.4">
			<job-tracker>quickstart.cloudera:8032</job-tracker>
			<name-node>quickstart.cloudera:8020</name-node>
			<command>
            import -Dhadoop.security.credential.provider.path=jceks://hdfs/user/root/mysql.password.jceks --connect jdbc:oracle:thin:@caliber-snap.cgbbs6xdwjwh.us-west-2.rds.amazonaws.com:1521/orcl --username caliber --password-alias mydb.password.alias --table CALIBER_ASSESSMENT --columns ASSESSMENT_ID,RAW_SCORE,ASSESSMENT_TYPE,WEEK_NUMBER,BATCH_ID,ASSESSMENT_CATEGORY --mysql-delimiters --target-dir project3/new/assessment --delete-target-dir -m 1
            </command>
		</sqoop>
        <ok to = "end" />
        <error to = "kill" />
	</action>

    <action name="Import_Batch">
		<sqoop xmlns="uri:oozie:sqoop-action:0.4">
			<job-tracker>quickstart.cloudera:8032</job-tracker>
			<name-node>quickstart.cloudera:8020</name-node>
			<command>
            import -Dhadoop.security.credential.provider.path=jceks://hdfs/user/root/mysql.password.jceks --connect jdbc:oracle:thin:@caliber-snap.cgbbs6xdwjwh.us-west-2.rds.amazonaws.com:1521/orcl --username caliber --password-alias mydb.password.alias --table CALIBER_BATCH --columns BATCH_ID,SKILL_TYPE,TRAINER_ID,ADDRESS_ID --mysql-delimiters --target-dir project3/new/batch --delete-target-dir -m 1
            </command>
		</sqoop>
        <ok to = "end" />
        <error to = "kill" />
	</action>

    <action name="Import_Grade">
		<sqoop xmlns="uri:oozie:sqoop-action:0.4">
			<job-tracker>quickstart.cloudera:8032</job-tracker>
			<name-node>quickstart.cloudera:8020</name-node>
			<command>
            import -Dhadoop.security.credential.provider.path=jceks://hdfs/user/root/mysql.password.jceks --connect jdbc:oracle:thin:@caliber-snap.cgbbs6xdwjwh.us-west-2.rds.amazonaws.com:1521/orcl --username caliber --password-alias mydb.password.alias --table CALIBER_GRADE --columns GRADE_ID,SCORE,ASSESSMENT_ID,TRAINEE_ID --mysql-delimiters --target-dir project3/new/grade --delete-target-dir -m 1
            </command>
		</sqoop>
        <ok to = "end" />
        <error to = "kill" />
	</action>

    <action name="Import_Note">
		<sqoop xmlns="uri:oozie:sqoop-action:0.4">
			<job-tracker>quickstart.cloudera:8032</job-tracker>
			<name-node>quickstart.cloudera:8020</name-node>
			<command>
            import -Dhadoop.security.credential.provider.path=jceks://hdfs/user/root/mysql.password.jceks --connect jdbc:oracle:thin:@caliber-snap.cgbbs6xdwjwh.us-west-2.rds.amazonaws.com:1521/orcl --username caliber --password-alias mydb.password.alias --table CALIBER_NOTE --columns NOTE_ID,QC_STATUS,NOTE_TYPE,WEEK_NUMBER,BATCH_ID,TRAINEE_ID --mysql-delimiters --target-dir project3/new/note --delete-target-dir -m 1
            </command>
		</sqoop>
        <ok to = "end" />
        <error to = "kill" />
	</action>

    <action name="Import_Trainee">
		<sqoop xmlns="uri:oozie:sqoop-action:0.4">
			<job-tracker>quickstart.cloudera:8032</job-tracker>
			<name-node>quickstart.cloudera:8020</name-node>
			<command>
            import -Dhadoop.security.credential.provider.path=jceks://hdfs/user/root/mysql.password.jceks --connect jdbc:oracle:thin:@caliber-snap.cgbbs6xdwjwh.us-west-2.rds.amazonaws.com:1521/orcl --username caliber --password-alias mydb.password.alias --table CALIBER_TRAINEE --columns TRAINEE_ID,TRAINEE_NAME,TRAINING_STATUS,BATCH_ID --mysql-delimiters --target-dir project3/new/trainee --delete-target-dir -m 1
            </command>
		</sqoop>
        <ok to = "end" />
        <error to = "kill" />
	</action>

    <action name="Import_Trainer">
		<sqoop xmlns="uri:oozie:sqoop-action:0.4">
			<job-tracker>quickstart.cloudera:8032</job-tracker>
			<name-node>quickstart.cloudera:8020</name-node>
			<command>
            import -Dhadoop.security.credential.provider.path=jceks://hdfs/user/root/mysql.password.jceks --connect jdbc:oracle:thin:@caliber-snap.cgbbs6xdwjwh.us-west-2.rds.amazonaws.com:1521/orcl --username caliber --password-alias mydb.password.alias --table CALIBER_TRAINER --columns TRAINER_ID,NAME --mysql-delimiters --target-dir project3/new/trainer --delete-target-dir -m 1
            </command>
		</sqoop>
        <ok to = "end" />
        <error to = "kill" />
	</action>

    <!-- Kill Workflow -->
	<kill name="kill">
		<message>message[${wf:errorMessage(wf:lastErrorNode())}]</message>
        <message>Job failed</message>
	</kill>
		
	<!-- End Workflow -->
	<end name="end" />

</workflow-app>