<workflow-app xmlns="uri:oozie:workflow:0.4" name="create-import-address">

    <!--Start Workflow-->
    <start to="clear-old-job">

    <!--Clear pre-existing job name-->
    <action name ="clear-old-job">
        <sqoop xmlns="uri:oozie:sqoop-action:0.4">
            <job-tracker>${resourceManager}</job-tracker>
            <name-node>${nameNode}</name-node>
            <arg>job</arg>
            <arg>-Dmapreduce.job.queuename=sqoop</arg>
            <arg>--meta-connect</arg>
            <arg>${metastoreConn}</arg>
            <arg>--delete</arg>
            <arg>import-address</arg>
        </sqoop>
        <ok to="create-new-job" />
        <error to="kill" />
    </action>

    <action name="create-new-job">
        <sqoop xmlns="uri:oozie:sqoop-action:0.4">
            <job-tracker>${resourceManager}</job-tracker>
            <name-node>${nameNode}</name-node>
            <arg>job</arg>
            <arg>-Dhadoop.security.credential.provider.path=jceks://hdfs/user/root/mysql.password.jceks</arg>
            <arg>-Dmapreduce.job.queuename=sqoop</arg>
            <arg>--create</arg>
            <arg>import-address</arg>
            <arg>--meta-connect</arg>
            <arg>${metastoreConn}</arg>
            <arg>--</arg>
            <arg>import</arg>
            <arg>--connect</arg>
            <arg>${caliberConn}</arg>
            <arg>--username</arg>
            <arg>${caliberUser}</arg>
            <arg>--password-alias</arg>
            <arg>${caliberPass}</arg>
            <arg>--table</arg>
            <arg>CALIBER_ADDRESS</arg>
            <arg>--columns</arg>
            <arg>ADDRESS_ID,ADDRESS_STREET,ADDRESS_CITY,ADDRESS_STATE,ADDRESS_ZIPCODE,ADDRESS_COMPANY,ACTIVE</arg>
            <arg>--mysql-delimiters</arg>
            <arg>--incremental</arg>
            <arg>append</arg>
            <arg>--check-column</arg>
            <arg>ADDRESS_ID</arg>
            <arg>--target-dir</arg>
            <arg>biforce/address</arg>
            <arg>--direct</arg>
            <arg>-m</arg>
            <arg>1</arg>
        </sqoop>
        <ok to="join-create-imports" />
        <error to="kill" />
    </action>

</workflow-app>